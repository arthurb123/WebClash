class Lynx2D{constructor(){this.CONTEXT={},this.GAME={RUNNING:!1,DEBUG:!1,DRAW_COLLIDERS:!1,BUFFER:[],UI:[],COLLIDERS:[],EVENTS:[],GO_MOUSE_EVENTS:[],UI_MOUSE_EVENTS:[],ON_RESIZE_EVENTS:[],LAYER_DRAW_EVENTS:[],LOOPS:[],SCALE:1,INIT:function(t){this.METRICS.DATE=(new Date).getSeconds(),this.METRICS.DATA.COUNTER=new lx.UIText("0 FPS | 0 UPS",25,35,16),null!=t&&(this.SETTINGS.FPS=t),this.RUNNING=!0,this.REQUEST_FRAME()},METRICS:{DATE:0,DATA:{FRAMES:0,UPDATES:0,R_DT:0,U_DT:0,TIMESTAMP:0,P_TIMESTAMP:0},UPDATE:function(){this.DATE!=(new Date).getSeconds()&&(this.DATE=(new Date).getSeconds(),this.DATA.COUNTER.Text(this.DATA.FRAMES+" FPS | "+this.DATA.UPDATES+" UPS"),this.DATA.FRAMES=0,this.DATA.UPDATES=0)}},LOG:{RECORDED:{},ERROR:function(t,i){this.RECORDED[t]||(this.RECORDED[t]=!0,console.log("%c"+t+":%c "+i,"color: red;",""))}},SETTINGS:{FPS:60,VSYNC:!1,AA:!0,LIMITERS:{PARTICLES:300}},PHYSICS:{STEPS:60},TIMESTAMP:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},CLEAR:function(){lx.CONTEXT.GRAPHICS.clearRect(0,0,lx.CONTEXT.GRAPHICS.canvas.width,lx.CONTEXT.GRAPHICS.canvas.height)},RESET:function(){this.BUFFER=[],this.EVENTS=[],this.UI=[],this.COLLIDERS=[],this.LAYER_DRAW_EVENTS=[],this.LOOPS=[],delete this.FOCUS},LOOP:function(){if(lx.GAME.RUNNING){lx.GAME.METRICS.DATA.TIMESTAMP=lx.GAME.TIMESTAMP();const t=Math.min(1,(lx.GAME.METRICS.DATA.TIMESTAMP-lx.GAME.METRICS.DATA.P_TIMESTAMP)/1e3);lx.GAME.METRICS.DATA.U_DT+=t,lx.GAME.METRICS.DATA.R_DT+=t;let i=1/60;for(;lx.GAME.METRICS.DATA.U_DT>=i;)lx.GAME.METRICS.DATA.U_DT-=i,lx.GAME.UPDATE();let E=1/lx.GAME.SETTINGS.FPS;lx.GAME.SETTINGS.VSYNC&&(E=0),lx.GAME.METRICS.DATA.R_DT>=E&&(lx.GAME.METRICS.DATA.R_DT-=E,lx.GAME.RENDER()),lx.GAME.METRICS.DATA.P_TIMESTAMP=lx.GAME.METRICS.DATA.TIMESTAMP}lx.GAME.REQUEST_FRAME()},UPDATE:function(){this.EVENTS.forEach(function(t){if(null!=t&&("key"==t.TYPE&&lx.CONTEXT.CONTROLLER.KEYS[t.EVENT]||"mousebutton"==t.TYPE&&lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[t.EVENT]))for(let i=0;i<t.CALLBACK.length;i++)if(null!=t.CALLBACK[i])try{let E=lx.CONTEXT.CONTROLLER.MOUSE.POS;null!=lx.GAME.FOCUS&&(E=lx.GAME.TRANSLATE_FROM_FOCUS({X:lx.GAME.FOCUS.POS.X+E.X-lx.GetDimensions().width,Y:lx.GAME.FOCUS.POS.Y+E.Y-lx.GetDimensions().height})),t.CALLBACK[i]({mousePosition:lx.CONTEXT.CONTROLLER.MOUSE.POS,worldPosition:E,state:1})}catch(t){lx.GAME.LOG.ERROR("EventUpdateError",t)}});for(let t=0;t<this.BUFFER.length;t++)if(null!=this.BUFFER[t]){let i=0;this.BUFFER[t].forEach(function(t){if(null!=t)try{t.UPDATE(),i++}catch(t){lx.GAME.LOG.ERROR("GameObjectUpdateError",t)}}),0==i&&(this.BUFFER[t]=[])}this.COLLIDERS.forEach(function(t){null!=t&&lx.GAME.COLLIDERS.forEach(function(i){if(null!=i&&t.COLLIDER_ID!=i.COLLIDER_ID)try{let E=!1;(E=i.CheckCollision(t))&&t.OnCollide({self:t,trigger:i,direction:E.direction,gameObject:E.gameObject,static:i.Static(),solid:i.Solid()})}catch(t){lx.GAME.LOG.ERROR("ColliderUpdateError",t)}})}),this.LOOPS.forEach(function(t){try{null!=t&&t()}catch(t){lx.GAME.LOG.ERROR("LoopHandleError",t)}}),this.UI.forEach(function(t){try{null!=t&&t.UPDATE()}catch(t){lx.GAME.LOG.ERROR("UIElementUpdateError",t)}}),this.AUDIO.UPDATE(),lx.GAME.SETTINGS.FPS<=0&&(lx.GAME.SETTINGS.FPS=1),this.METRICS.UPDATE(),this.METRICS.DATA.UPDATES++},RENDER:function(){this.CLEAR(),lx.CONTEXT.GRAPHICS.imageSmoothingEnabled=this.SETTINGS.AA;for(let t=0;t<this.BUFFER.length;t++){try{null!=this.BUFFER[t]&&this.BUFFER[t].forEach(function(t){null!=t&&t.RENDER()})}catch(t){lx.GAME.LOG.ERROR("BufferRenderError",t)}try{if(null!=this.LAYER_DRAW_EVENTS[t])for(let i=0;i<this.LAYER_DRAW_EVENTS[t].length;i++)null!=this.LAYER_DRAW_EVENTS[t][i]&&this.LAYER_DRAW_EVENTS[t][i](lx.CONTEXT.GRAPHICS)}catch(t){lx.GAME.LOG.ERROR("LayerDrawEventError",t)}}this.DEBUG&&this.METRICS.DATA.COUNTER.RENDER(),this.DRAW_COLLIDERS&&this.COLLIDERS.forEach(function(t){null!=t&&lx.CONTEXT.GRAPHICS.strokeRect(lx.GAME.TRANSLATE_FROM_FOCUS(t.POS).X,lx.GAME.TRANSLATE_FROM_FOCUS(t.POS).Y,t.SIZE.W*lx.GAME.SCALE,t.SIZE.H*lx.GAME.SCALE)});for(let t=0;t<this.UI.length;t++)null!=this.UI[t]&&(null!=this.UI[t].UI_ID?this.UI[t].RENDER():this.UI[t]=void 0);this.METRICS.DATA.FRAMES++},REQUEST_FRAME:function(){window.requestAnimationFrame(lx.GAME.LOOP)},ADD_TO_BUFFER:function(t,i){null==this.BUFFER[i]&&(this.BUFFER[i]=[]);for(let E=0;E<this.BUFFER[i].length+1;E++)if(null==this.BUFFER[i][E])return this.BUFFER[i][E]=t,E},SWITCH_BUFFER_POSITION:function(t,i){if(-1===t.BUFFER_ID||-1===i.BUFFER_ID||t.BUFFER_LAYER!==i.BUFFER_LAYER)return;let E=t.BUFFER_ID;t.BUFFER_ID=i.BUFFER_ID,i.BUFFER_ID=E,this.BUFFER[t.BUFFER_LAYER][t.BUFFER_ID]=t,this.BUFFER[t.BUFFER_LAYER][i.BUFFER_ID]=i},ADD_LOOPS:function(t){if(null==t)return-1;for(let i=0;i<this.LOOPS.length+1;i++)if(null==this.LOOPS[i])return this.LOOPS[i]=t,i},ADD_EVENT:function(t,i,E){for(let s=0;s<this.EVENTS.length;s++)if(null!=this.EVENTS[s]&&this.EVENTS[s].TYPE==t&&this.EVENTS[s].EVENT==i)for(let t=0;t<=this.EVENTS[s].CALLBACK.length;t++)if(null==this.EVENTS[s].CALLBACK[t])return this.EVENTS[s].CALLBACK[t]=E,t;for(let s=0;s<this.EVENTS.length+1;s++)if(null==this.EVENTS[s])return this.EVENTS[s]={TYPE:t,EVENT:i,CALLBACK:[E]},s},INVALIDATE_EVENT:function(t,i){for(let E=0;E<this.EVENTS.length;E++)if(null!=this.EVENTS[E]&&this.EVENTS[E].TYPE==t&&this.EVENTS[E].EVENT==i)for(let t=0;t<this.EVENTS[E].CALLBACK.length;t++)if(null!=this.EVENTS[E].CALLBACK[t]){let i=lx.CONTEXT.CONTROLLER.MOUSE.POS;null!=this.FOCUS&&(i=this.TRANSLATE_FROM_FOCUS({X:this.FOCUS.POS.X+i.X-lx.GetDimensions().width,Y:this.FOCUS.POS.Y+i.Y-lx.GetDimensions().height})),this.EVENTS[E].CALLBACK[t]({mousePosition:lx.CONTEXT.CONTROLLER.MOUSE.POS,worldPosition:i,state:0})}},CLEAR_EVENT:function(t,i,E){for(let s=0;s<this.EVENTS.length;s++)if(this.EVENTS[s].TYPE==t&&this.EVENTS[s].EVENT==i)return void(null!=E?this.EVENTS[s].CALLBACK[E]=void 0:this.EVENTS.splice(s,1))},ADD_COLLIDER:function(t){for(let i=0;i<this.COLLIDERS.length+1;i++)if(null==this.COLLIDERS[i])return this.COLLIDERS[i]=t,i},ADD_UI_ELEMENT:function(t){for(let i=0;i<this.UI.length+1;i++)if(null==this.UI[i])return this.UI[i]=t,i},FOCUS_GAMEOBJECT:function(t){this.FOCUS=t},TRANSLATE_FROM_FOCUS:function(t){return null==this.FOCUS?t:(null==this.FOCUS.SIZE?this.FOCUS.SIZE={W:0,H:0}:null!=this.FOCUS.SIZE.W&&null!=this.FOCUS.SIZE.H||(this.FOCUS.SIZE.W=0,this.FOCUS.SIZE.H=0),{X:Math.floor(Math.round(t.X)-Math.round(this.FOCUS.Position().X)+lx.GetDimensions().width/(2*this.SCALE)-this.FOCUS.SIZE.W/2)*this.SCALE,Y:Math.floor(Math.round(t.Y)-Math.round(this.FOCUS.Position().Y)+lx.GetDimensions().height/(2*this.SCALE)-this.FOCUS.SIZE.H/2)*this.SCALE})},UNTRANSLATE_FROM_FOCUS:function(t){return null==this.FOCUS?t:(null==this.FOCUS.SIZE?this.FOCUS.SIZE={W:0,H:0}:null!=this.FOCUS.SIZE.W&&null!=this.FOCUS.SIZE.H||(this.FOCUS.SIZE.W=0,this.FOCUS.SIZE.H=0),{X:Math.floor(Math.round(t.X)+Math.round(this.FOCUS.Position().X)-lx.GetDimensions().width/2+this.FOCUS.SIZE.W/2),Y:Math.floor(Math.round(t.Y)+Math.round(this.FOCUS.Position().Y)-lx.GetDimensions().height/2+this.FOCUS.SIZE.H/2)})},ON_SCREEN:function(t,i){return null!=this.FOCUS?Math.abs(this.FOCUS.Position().X-t.X)<=lx.GetDimensions().width/2+i.W&&Math.abs(this.FOCUS.Position().Y-t.Y)<=lx.GetDimensions().height/2+i.H:t.X+i.W>0&&t.X<lx.GetDimensions().width&&t.Y+i.H>0&&t.Y<lx.GetDimensions().height},ADD_LAYER_DRAW_EVENT:function(t,i){null==this.BUFFER[t]&&(this.BUFFER[t]=[]),null==this.LAYER_DRAW_EVENTS[t]&&(this.LAYER_DRAW_EVENTS[t]=[]);for(let E=0;E<this.LAYER_DRAW_EVENTS[t].length+1;E++)if(null==this.LAYER_DRAW_EVENTS[t][E])return this.LAYER_DRAW_EVENTS[t][E]=i,E;return-1},CLEAR_LAYER_DRAW_EVENT:function(t){this.LAYER_DRAW_EVENTS[t]=void 0},AUDIO:{CAN_PLAY:!1,SOUNDS:[],CHANNELS:[],SET_CHANNEL_VOLUME:function(t,i){this.CHANNELS[t]=i},GET_CHANNEL_VOLUME:function(t){return null==this.CHANNELS[t]&&this.SET_CHANNEL_VOLUME(t,1),this.CHANNELS[t]},ADD:function(t,i,E,s){if(this.CAN_PLAY&&""!=t){null==this.CHANNELS[i]&&this.SET_CHANNEL_VOLUME(i,1);for(let h=0;h<=this.SOUNDS.length;h++)if(null==this.SOUNDS[h])return this.SOUNDS[h]={CUR:0,SRC:t,CHANNEL:i,SPATIAL:!1,DELAY:E,LOOPS:s,PLAYING:!1},h}},ADD_SPATIAL:function(t,i,E,s,h){if(this.CAN_PLAY&&""!=i){null==this.CHANNELS[E]&&this.SET_CHANNEL_VOLUME(E,1);for(let l=0;l<=this.SOUNDS.length;l++)if(null==this.SOUNDS[l])return this.SOUNDS[l]={CUR:0,POS:t,SRC:i,SPATIAL:!0,CHANNEL:E,DELAY:s,LOOPS:h,PLAYING:!1},l}},CALCULATE_SPATIAL:function(t,i){t=lx.GAME.TRANSLATE_FROM_FOCUS(t);let E=1-Math.abs(t.X-lx.GetDimensions().width/2)/(lx.GetDimensions().width/2),s=1-Math.abs(t.Y-lx.GetDimensions().height/2)/(lx.GetDimensions().height/2),h=this.CHANNELS[i];return((h*=E>=s?E:s)<0||t.X<0||t.Y<0||t.X>lx.GetDimensions().width||t.Y>lx.GetDimensions().height)&&(h=0),h},UPDATE:function(){if(this.CAN_PLAY)for(let t=0;t<this.SOUNDS.length;t++)if(null!=this.SOUNDS[t])if(this.SOUNDS[t].PLAYING)this.SOUNDS[t].SPATIAL&&(this.SOUNDS[t].AUDIO.volume=this.CALCULATE_SPATIAL(this.SOUNDS[t].POS,this.SOUNDS[t].CHANNEL));else if(this.SOUNDS[t].CUR++,null==this.SOUNDS[t].DELAY||this.SOUNDS[t].CUR>=this.SOUNDS[t].DELAY){let i=new Audio;i.type="audio/mpeg",i.src=this.SOUNDS[t].SRC,i.play_id=t,i.onended=function(){lx.GAME.AUDIO.SOUNDS[this.play_id].LOOPS?lx.GAME.AUDIO.SOUNDS[this.play_id].AUDIO.play():lx.GAME.AUDIO.SOUNDS[this.play_id]=void 0},this.SOUNDS[t].SPATIAL?i.volume=this.CALCULATE_SPATIAL(this.SOUNDS[t].POS,this.SOUNDS[t].CHANNEL):i.volume=this.CHANNELS[this.SOUNDS[t].CHANNEL],this.SOUNDS[t].PLAYING=!0,this.SOUNDS[t].AUDIO=i,this.SOUNDS[t].AUDIO.play()}},REMOVE:function(t){null!=t&&null!=this.SOUNDS[t]&&this.SOUNDS[t].PLAYING&&(this.SOUNDS[t].AUDIO.pause(),this.SOUNDS[t].AUDIO.currentTime=0,this.SOUNDS[t]=void 0)}},ADD_GO_MOUSE_EVENT:function(t,i,E){for(let s=0;s<this.GO_MOUSE_EVENTS.length+1;s++)if(null==this.GO_MOUSE_EVENTS[s])return this.GO_MOUSE_EVENTS[s]={GO:t,BUTTON:i,CALLBACK:E},s;return-1},REMOVE_GO_MOUSE_EVENT:function(t){this.GO_MOUSE_EVENTS[t]=void 0},ADD_UI_MOUSE_EVENT:function(t,i,E){for(let s=0;s<this.UI_MOUSE_EVENTS.length+1;s++)if(null==this.UI_MOUSE_EVENTS[s])return this.UI_MOUSE_EVENTS[s]={UI:t,UI:t,BUTTON:i,CALLBACK:E},s;return-1},REMOVE_UI_MOUSE_EVENT:function(t){this.UI_MOUSE_EVENTS[t]=void 0},HANDLE_MOUSE_CLICK:function(t){for(let i=0;i<this.GO_MOUSE_EVENTS.length;i++){let E=this.GO_MOUSE_EVENTS[i];null!=E&&E.BUTTON==t&&(null==E.GO?this.REMOVE_GO_MOUSE_EVENT(i):lx.GAME.GET_MOUSE_IN_BOX(E.GO.POS,E.GO.SIZE)&&E.CALLBACK({mousePosition:lx.CONTEXT.CONTROLLER.MOUSE.POS,state:1}))}for(let i=0;i<this.UI_MOUSE_EVENTS.length;i++){let E=this.UI_MOUSE_EVENTS[i];null!=E&&E.BUTTON==t&&(null==E.UI?this.REMOVE_UI_MOUSE_EVENT(i):lx.GAME.GET_MOUSE_IN_BOX(E.UI.POS,E.UI.SIZE,null!=E.UI.TARGET)&&E.CALLBACK({mousePosition:lx.CONTEXT.CONTROLLER.MOUSE.POS,state:1}))}},GET_MOUSE_IN_BOX:function(t,i,E){return null!=this.FOCUS&&(E||null==E)&&(t=this.TRANSLATE_FROM_FOCUS(t)),i={W:i.W*this.SCALE,H:i.H*this.SCALE},t.X<=lx.CONTEXT.CONTROLLER.MOUSE.POS.X&&t.X+i.W>=lx.CONTEXT.CONTROLLER.MOUSE.POS.X&&t.Y<=lx.CONTEXT.CONTROLLER.MOUSE.POS.Y&&t.Y+i.H>=lx.CONTEXT.CONTROLLER.MOUSE.POS.Y},ADD_ON_RESIZE_EVENT:function(t){for(let i=0;i<this.ON_RESIZE_EVENTS.length+1;i++)if(null==this.ON_RESIZE_EVENTS[i]){this.ON_RESIZE_EVENTS[i]=t;break}}},this.Initialize=function(t){this.CONTEXT.CANVAS=document.createElement("canvas"),this.CONTEXT.CANVAS.id="lynx-canvas",this.CONTEXT.CANVAS.style="background-color: #282828;",this.CONTEXT.CANVAS.innerHTML="HTML5 canvas not supported on this browser.",this.CONTEXT.CANVAS.oncontextmenu=function(t){return t.preventDefault(),!1},this.CONTEXT.GRAPHICS=this.CONTEXT.CANVAS.getContext("2d");let i="string"==typeof t;return(null==t||i)&&(i&&(document.title=t),t=document.body,this.CONTEXT.CANVAS.style="background-color: #282828; position: absolute; top: 0px; left: 0px;"),t.appendChild(this.CONTEXT.CANVAS),window.onresize=function(){let i=t.offsetWidth,E=t.offsetWidth;t==document.body&&(i=self.innerWidth,E=self.innerHeight);let s=i-lx.CONTEXT.CANVAS.width,h=E-lx.CONTEXT.CANVAS.height;lx.GAME.ON_RESIZE_EVENTS.forEach(function(t){t({dx:s,dy:h,oldWidth:lx.CONTEXT.CANVAS.width,oldHeight:lx.CONTEXT.CANVAS.height,width:i,height:E})}),lx.CONTEXT.CANVAS.width=i,lx.CONTEXT.CANVAS.height=E},window.onresize(),null==this.CONTEXT.CONTROLLER&&this.CreateController(),this},this.Start=function(t){return null==t&&(t=60),this.GAME.INIT(t),this},this.Background=function(t){return null==this.CONTEXT.CANVAS?null!=t?this:void 0:null==t?this.CONTEXT.CANVAS.style.backgroundColor:(this.CONTEXT.CANVAS.style.backgroundColor=t,this)},this.Scale=function(t){if(null==t)return this.GAME.SCALE;this.GAME.SCALE=t},this.GetDimensions=function(){return null==this.CONTEXT.CANVAS?(this.GAME.LOG.ERROR("DimensionRetrievalError","Could not get canvas dimensions, Lynx2D is probably not initialized yet."),{width:self.innerWidth,height:self.innerHeight}):{width:this.CONTEXT.CANVAS.width,height:this.CONTEXT.CANVAS.height}},this.LoadScene=function(t){return this.GAME.RESET(),this.CreateController(),t.CALLBACK(),null!=t.ENGINE_ID&&console.log("ENGINE_INTERACTION_LOAD_SCENE("+t.ENGINE_ID+")"),this},this.CreateController=function(){this.CONTEXT.CONTROLLER={KEYS:[],STOPPED_KEYS:[],MOUSE:{POS:{X:0,Y:0},BUTTONS:[],STOPPED_BUTTONS:[]}},this.GAME.EVENTS=[],document.addEventListener("keydown",function(t){lx.GAME.AUDIO.CAN_PLAY=!0,lx.CONTEXT.CONTROLLER.STOPPED_KEYS[String.fromCharCode(t.keyCode).toLowerCase()]||(27===t.keyCode&&(lx.CONTEXT.CONTROLLER.KEYS.escape=!0),lx.CONTEXT.CONTROLLER.KEYS[String.fromCharCode(t.keyCode).toLowerCase()]=!0,lx.CONTEXT.CONTROLLER.KEYS[t.keyCode]=!0)}),document.addEventListener("keyup",function(t){lx.CONTEXT.CONTROLLER.STOPPED_KEYS[String.fromCharCode(t.keyCode).toLowerCase()]||lx.GAME.INVALIDATE_EVENT("key",String.fromCharCode(t.keyCode).toLowerCase()),lx.CONTEXT.CONTROLLER.STOPPED_KEYS[String.fromCharCode(t.keyCode).toLowerCase()]=!1,27===t.keyCode&&(lx.CONTEXT.CONTROLLER.KEYS.escape=!1),lx.CONTEXT.CONTROLLER.KEYS[String.fromCharCode(t.keyCode).toLowerCase()]=!1,lx.CONTEXT.CONTROLLER.KEYS[t.keyCode]=!1}),this.CONTEXT.CANVAS.addEventListener("mousedown",function(t){lx.GAME.AUDIO.CAN_PLAY=!0,lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[t.button]||(lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[t.button]=!0,lx.GAME.HANDLE_MOUSE_CLICK(t.button))}),this.CONTEXT.CANVAS.addEventListener("mouseup",function(t){lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[t.button]||lx.GAME.INVALIDATE_EVENT("mousebutton",t.button),lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[t.button]=!1,lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[t.button]=!1}),document.addEventListener("mousemove",function(t){lx.CONTEXT.CONTROLLER.MOUSE.POS={X:t.pageX,Y:t.pageY},null!=lx.CONTEXT.CONTROLLER.MOUSE.ON_HOVER&&lx.CONTEXT.CONTROLLER.MOUSE.ON_HOVER(lx.CONTEXT.CONTROLLER.MOUSE.POS)});const t={passive:!0};return this.CONTEXT.CANVAS.addEventListener("touchstart",function(t){lx.GAME.AUDIO.CAN_PLAY=!0;let i=t.touches[0];lx.CONTEXT.CONTROLLER.MOUSE.POS={X:i.pageX,Y:i.pageY},lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[0]||(lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[0]=!0,lx.GAME.HANDLE_MOUSE_CLICK(0))},t),this.CONTEXT.CANVAS.addEventListener("touchend",function(t){lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[0]||lx.GAME.INVALIDATE_EVENT("mousebutton",0),lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[0]=!1,lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[0]=!1},t),this},this.GetFocus=function(){return this.GAME.FOCUS},this.ResetCentering=function(){return this.GAME.FOCUS=void 0,this},this.Smoothing=function(t){return null==t?this.GAME.SETTINGS.AA:(this.GAME.SETTINGS.AA=t,this)},this.Framerate=function(t){return null==t?this.GAME.SETTINGS.FPS:(this.GAME.SETTINGS.FPS=t,this)},this.VerticalSync=function(t){return null==t?this.GAME.SETTINGS.VSYNC:(this.GAME.SETTINGS.VSYNC=t,this)},this.ParticleLimit=function(t){return null==t?this.GAME.SETTINGS.LIMITERS.PARTICLES:(this.GAME.SETTINGS.LIMITERS.PARTICLES=t,this)},this.ChannelVolume=function(t,i){if(null!=t&&null!=i)this.GAME.AUDIO.SET_CHANNEL_VOLUME(t,i);else if(null!=t)return this.GAME.AUDIO.GET_CHANNEL_VOLUME(t);return this},this.FindGameObjectWithCollider=function(t){for(let i=0;i<this.GAME.BUFFER.length;i++)if(null!=this.GAME.BUFFER[i])for(let E=0;E<this.GAME.BUFFER[i].length;E++)if(null!=this.GAME.BUFFER[i][E]&&null!=this.GAME.BUFFER[i][E].COLLIDER&&this.GAME.BUFFER[i][E].COLLIDER.COLLIDER_ID==t.COLLIDER_ID)return this.GAME.BUFFER[i][E]},this.FindGameObjectWithIdentifier=function(t){for(let i=0;i<this.GAME.BUFFER.length;i++)if(null!=this.GAME.BUFFER[i])for(let E=0;E<this.GAME.BUFFER[i].length;E++)if(null!=this.GAME.BUFFER[i][E]&&null!=this.GAME.BUFFER[i][E].Identifier&&this.GAME.BUFFER[i][E].Identifier()===t)return this.GAME.BUFFER[i][E]},this.FindGameObjectsWithIdentifier=function(t){let i=[];for(let E=0;E<this.GAME.BUFFER.length;E++)if(null!=this.GAME.BUFFER[E]){for(let s=0;s<this.GAME.BUFFER[E].length;s++)null!=this.GAME.BUFFER[E][s]&&null!=this.GAME.BUFFER[E][s].Identifier&&this.GAME.BUFFER[E][s].Identifier()===t&&(i[i.length]=this.GAME.BUFFER[E][s]);return i}},this.OnKey=function(t,i){return isNaN(t)?this.GAME.ADD_EVENT("key",t.toLowerCase(),i):this.GAME.ADD_EVENT("key",t,i),this},this.ClearKey=function(t){return this.GAME.CLEAR_EVENT("key",t.toLowerCase()),this},this.StopKey=function(t){return lx.CONTEXT.CONTROLLER.KEYS[t.toLowerCase()]=!1,lx.CONTEXT.CONTROLLER.STOPPED_KEYS[t.toLowerCase()]=!0,this},this.OnMouse=function(t,i){return this.GAME.ADD_EVENT("mousebutton",t,i),this},this.ClearMouse=function(t){return this.GAME.CLEAR_EVENT("mousebutton",t),this},this.StopMouse=function(t){return lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[t]=!1,lx.CONTEXT.CONTROLLER.MOUSE.STOPPED_BUTTONS[t]=!0,this},this.OnMouseMove=function(t){return null!=lx.CONTEXT.CONTROLLER&&(lx.CONTEXT.CONTROLLER.MOUSE.ON_HOVER=t),this},this.ClearMouseMove=function(){return lx.CONTEXT.CONTROLLER.MOUSE.ON_HOVER=void 0,this},this.OnResize=function(t){return this.GAME.ADD_ON_RESIZE_EVENT(t),this},this.ClearResize=function(){this.GAME.ON_RESIZE_EVENTS=[]},this.Loops=function(t){return this.GAME.ADD_LOOPS(t),this},this.ClearLoops=function(){return this.GAME.LOOPS=[],this},this.OnLayerDraw=function(t,i){return this.GAME.ADD_LAYER_DRAW_EVENT(t,i),this},this.ClearLayerDraw=function(t){return this.GAME.CLEAR_LAYER_DRAW_EVENT(t),this},this.ResetLayerDraw=function(){return this.GAME.LAYER_DRAW_EVENTS=[],this},this.DrawSprite=function(t,i,E,s,h){if(null!=s&&null!=h||(s=t.Size().W,h=t.Size().H),lx.GAME.ON_SCREEN({X:i,Y:E},{W:s,H:h}))return t.RENDER(this.GAME.TRANSLATE_FROM_FOCUS({X:i,Y:E}),{W:s,H:h}),this},this.CreateHorizontalTileSheet=function(t,i,E){let s=[],h=Math.round(t.Size().W/i),l=Math.round(t.Size().H/E);for(let O=0;O<l;O++){null==s[O]&&(s[O]=[]);for(let l=0;l<h;l++)s[O][l]=new lx.Sprite(t.IMG,l*i,O*E,i,E)}return s},this.CreateVerticalTileSheet=function(t,i,E){let s=[],h=Math.round(t.Size().W/i),l=Math.round(t.Size().H/E);for(let O=0;O<h;O++){null==s[O]&&(s[O]=[]);for(let h=0;h<l;h++)s[O][h]=new lx.Sprite(t.IMG,O*i,h*E,i,E)}return s},this.MoveToPosition=function(t,i,E,s){if(t.BEING_MOVED)return;t.BEING_MOVED=!0;let h=s/1e3*60,l=i-t.Position().X,O=E-t.Position().Y,T=l/h,S=O/h,n=lx.GAME.ADD_LOOPS(function(){t.POS.X+=T,t.POS.Y+=S,--h<=0&&(lx.GAME.LOOPS[n]=void 0,delete t.BEING_MOVED)})};class t{constructor(t,i){this.BUFFER_ID=-1,this.POS={X:null==t?0:t,Y:null==i?0:i},this.OFFSET={X:this.POS.X,Y:this.POS.Y}}Show(t){return-1!=this.BUFFER_ID&&this.Hide(),null==t&&(t=0),this.BUFFER_ID=lx.GAME.ADD_TO_BUFFER(this,t),this.BUFFER_LAYER=t,arguments.length>1&&lx.GAME.LOG.ERROR("ShowOverloadError","Too many arguments were supplied to the Show function, this might indicate that older method calls are present that are not being supported anymore (E.G: Animation Show method). Please check the documentation for updated objects and methods."),this}Hide(){if(-1!=this.BUFFER_ID)return null!=lx.GAME.BUFFER[this.BUFFER_LAYER]&&(lx.GAME.BUFFER[this.BUFFER_LAYER][this.BUFFER_ID]=void 0),this.BUFFER_ID=-1,this}Position(t,i){return null==t||null==i?this.POS:(this.POS={X:t,Y:i},null!=this.TARGET&&(this.OFFSET={X:t,Y:i}),this)}Follows(t){return null==t?this.TARGET:(this.TARGET=t,this)}StopFollowing(){return delete this.TARGET,this.POS={X:this.OFFSET.X,Y:this.OFFSET.Y},this}Loops(t){return this.LOOPS=t,this}ClearLoops(){return this.LOOPS=void 0,this}}this.Animation=class extends t{constructor(t,i){super(0,0),this.SIZE={W:0,H:0},this.SPRITES=t,this.FRAME=0,this.ROTATION=0,this.MAX_FRAMES=t.length,this.TIMER={FRAMES:[],STANDARD:i,CURRENT:0}}ShowAmount(t,i){return null!=i&&(this.MAX_AMOUNT=i),super.Show(t)}Size(t,i){return null==t&&null==i?this.SIZE:(null==i&&(i=t),this.SIZE={W:t,H:i},this)}Speed(t){return null==t?this.TIMER.STANDARD:(this.TIMER.STANDARD=t,this)}Rotation(t){return null==t?this.ROTATION:(this.ROTATION=t,this)}GET_CURRENT_FRAME(){return this.SPRITES[this.FRAME]}RENDER(t,i,E){let s=this.GET_CURRENT_FRAME();null!=s&&(s.ROTATION=this.ROTATION,-1===this.BUFFER_ID?s.RENDER(t,i,E):(0===(i=this.SIZE).W&&0===i.H&&(i=s.SPRITE_SIZE),s.RENDER(lx.GAME.TRANSLATE_FROM_FOCUS(this.POS),i,E)))}UPDATE(){this.TIMER.FRAMES.length===this.MAX_FRAMES&&(this.TIMER.STANDARD=this.TIMER.FRAMES[this.FRAME]),this.TIMER.CURRENT++,this.TIMER.CURRENT>=this.TIMER.STANDARD&&(this.TIMER.CURRENT=0,this.FRAME++,this.FRAME>=this.MAX_FRAMES&&(this.FRAME=0,null!=this.MAX_AMOUNT&&(0==this.MAX_AMOUNT?(delete this.MAX_AMOUNT,this.Hide()):this.MAX_AMOUNT--))),null!=this.LOOPS&&this.LOOPS()}},this.Canvas=class{constructor(t,i){this.CANVAS=document.createElement("canvas"),this.CANVAS.width=t,this.CANVAS.height=i,this.GRAPHICS=this.CANVAS.getContext("2d")}Size(){return{W:this.CANVAS.width,H:this.CANVAS.height}}DrawSprite(t,i,E,s,h){let l=t.Size();null!=s&&null!=h&&(l={W:s,H:h}),t.RENDER({X:i,Y:E},l,t.Opacity(),this.GRAPHICS)}Draw(t){t(this.GRAPHICS)}},this.Collider=class{constructor(t,i,E,s,h,l){this.POS={X:t,Y:i},this.OFFSET={X:0,Y:0},this.SIZE={W:E,H:s},this.STATIC=h,this.SOLID=!0,this.ENABLED=!1,this.OnCollide=null!=l?l:function(){},h&&this.Enable()}Size(t,i){return null==t||null==i?this.SIZE:(this.SIZE={W:t,H:i},this)}Static(t){return null==t?this.STATIC:(this.STATIC=t,this)}Solid(t){return null==t?this.SOLID:(this.SOLID=t,this)}Position(t,i){return null==t||null==i?this.POS:(this.POS={X:t,Y:i},this)}Identifier(t){return null==t?this.IDENTIFIER:(this.IDENTIFIER=t,this)}Enable(){if(!this.ENABLED)return this.COLLIDER_ID=lx.GAME.ADD_COLLIDER(this),this.ENABLED=!0,this}Disable(){if(this.ENABLED)return lx.GAME.COLLIDERS[this.COLLIDER_ID]=void 0,this.COLLIDER_ID=void 0,this.ENABLED=!1,this}CheckCollision(t){if(0!=this.POS.X&&0!=this.POS.Y&&this.POS.X==this.OFFSET.X&&this.POS.Y==this.OFFSET.Y)return!1;if(!(t.POS.Y+t.SIZE.H<this.POS.Y||t.POS.Y>this.POS.Y+this.SIZE.H||t.POS.X+t.SIZE.W<this.POS.X||t.POS.X>this.POS.X+this.SIZE.W)){let i;[{tag:"right",actual:Math.abs(this.POS.X-t.POS.X-t.SIZE.W)},{tag:"left",actual:Math.abs(t.POS.X-this.POS.X-this.SIZE.W)},{tag:"down",actual:Math.abs(this.POS.Y-t.POS.Y-t.SIZE.H)},{tag:"up",actual:Math.abs(t.POS.Y-this.POS.Y-this.SIZE.H)}].forEach(function(t){(null==i||t.actual<i.actual)&&(i=t)});let E={direction:i.tag};if(this.SOLID&&!t.STATIC){let s=lx.FindGameObjectWithCollider(t);if(null!=s){E.gameObject=s;let t=s.Position();switch(i.tag){case"right":s.Position(t.X-i.actual,t.Y);break;case"left":s.Position(t.X+i.actual,t.Y);break;case"down":s.Position(t.X,t.Y-i.actual);break;case"up":s.Position(t.X,t.Y+i.actual)}}}return E}return!1}},this.Emitter=class extends t{constructor(t,i,E,s,h){super(i,E),this.SPRITE=t,this.MOVEMENT={MIN_VX:-1,MAX_VX:1,MIN_VY:-1,MAX_VY:1,DECELERATES:!0},this.OFFSET={X:i,Y:E},this.SIZE={MIN:8,MAX:16},this.RANGE={X:1,Y:1},this.TIMER={STANDARD:60,CURRENT:60},this.AMOUNT=s,this.DURATION=h,this.PARTICLES=[]}Setup(t,i,E,s,h,l){return this.MOVEMENT.MIN_VX=t,this.MOVEMENT.MAX_VX=i,this.MOVEMENT.MIN_VY=E,this.MOVEMENT.MAX_VY=s,this.SIZE.MIN=h,this.SIZE.MAX=l,this}Range(t,i){return null==t||null==i?this.RANGE:(this.RANGE={X:t,Y:i},this)}Speed(t){return null==t?this.TIMER.STANDARD:(this.TIMER.STANDARD=t,this)}MovementDecelerates(t){return null==t?this.MOVEMENT.DECELERATES:(this.MOVEMENT.DECELERATES=t,this)}Emit(t,i){return this.TIMER.CURRENT=this.TIMER.STANDARD,this.HIDES_AFTER_AMOUNT=i,this.Show(t),this}RENDER(){for(let t=0;t<this.PARTICLES.length;t++)lx.CONTEXT.GRAPHICS.save(),lx.CONTEXT.GRAPHICS.globalAlpha=this.PARTICLES[t].OPACITY,lx.DrawSprite(this.SPRITE,this.PARTICLES[t].POS.X,this.PARTICLES[t].POS.Y,this.PARTICLES[t].SIZE,this.PARTICLES[t].SIZE),lx.CONTEXT.GRAPHICS.restore()}UPDATE(){null!=this.TARGET&&(this.POS={X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y});let t=this.MOVEMENT.MAX_VX/lx.GAME.PHYSICS.STEPS,i=this.MOVEMENT.MAX_VY/lx.GAME.PHYSICS.STEPS;for(let E=0;E<this.PARTICLES.length;E++)this.PARTICLES[E].TIMER.CURRENT>=this.PARTICLES[E].TIMER.STANDARD?this.PARTICLES.splice(E,1):(this.MOVEMENT.DECELERATES&&(this.PARTICLES[E].MOVEMENT.VX>0&&(this.PARTICLES[E].MOVEMENT.VX-t<0?this.PARTICLES[E].MOVEMENT.VX=0:this.PARTICLES[E].MOVEMENT.VX-=t),this.PARTICLES[E].MOVEMENT.VY>0&&(this.PARTICLES[E].MOVEMENT.VY-i<0?this.PARTICLES[E].MOVEMENT.VY=0:this.PARTICLES[E].MOVEMENT.VY-=i),this.PARTICLES[E].MOVEMENT.VX<0&&(this.PARTICLES[E].MOVEMENT.VX+t>0?this.PARTICLES[E].MOVEMENT.VX=0:this.PARTICLES[E].MOVEMENT.VX+=t),this.PARTICLES[E].MOVEMENT.VY<0&&(this.PARTICLES[E].MOVEMENT.VY+i>0?this.PARTICLES[E].MOVEMENT.VY=0:this.PARTICLES[E].MOVEMENT.VY+=i)),this.PARTICLES[E].POS.X+=this.PARTICLES[E].MOVEMENT.VX,this.PARTICLES[E].POS.Y+=this.PARTICLES[E].MOVEMENT.VY,this.PARTICLES[E].TIMER.CURRENT++,this.PARTICLES[E].OPACITY>0&&(this.PARTICLES[E].OPACITY-=1/this.PARTICLES[E].TIMER.STANDARD),this.PARTICLES[E].OPACITY<0&&(this.PARTICLES[E].OPACITY=0));if(this.TIMER.CURRENT>=this.TIMER.STANDARD){for(let t=0;t<this.AMOUNT&&!(this.PARTICLES.length>=lx.GAME.SETTINGS.LIMITERS.PARTICLES);t++)this.PARTICLES.unshift({POS:{X:this.POS.X-this.SIZE.MAX/2+Math.random()*this.RANGE.X-Math.random()*this.RANGE.X,Y:this.POS.Y-this.SIZE.MAX/2+Math.random()*this.RANGE.Y-Math.random()*this.RANGE.Y},SIZE:this.SIZE.MIN+Math.random()*(this.SIZE.MAX-this.SIZE.MIN),MOVEMENT:{VX:Math.random()*this.MOVEMENT.MIN_VX+Math.random()*this.MOVEMENT.MAX_VX,VY:Math.random()*this.MOVEMENT.MIN_VY+Math.random()*this.MOVEMENT.MAX_VY},TIMER:{STANDARD:this.DURATION,CURRENT:0},OPACITY:1});this.TIMER.CURRENT=0,null!=this.HIDES_AFTER_AMOUNT&&(this.HIDES_AFTER_AMOUNT<=0?(this.Hide(),this.HIDES_AFTER_AMOUNT=void 0):this.HIDES_AFTER_AMOUNT--)}else this.TIMER.CURRENT++}},this.GameObject=class extends t{constructor(t,i,E,s,h){super(i,E),this.SPRITE=t,this.CLICK_ID=[],this.OPACITY=1,this.SIZE={W:0,H:0},null!=s&&null!=h?this.SIZE={W:s,H:h}:null!=t?this.SIZE=t.SPRITE_SIZE:lx.GAME.LOG.ERROR("GameObjectCreationError","Created a GameObject without a proper size."),this.MOVEMENT={VX:0,VY:0,VMAX_X:2,VMAX_Y:2,WEIGHT:1.1,DECELERATES:!0,UPDATE:function(){if(this.DECELERATES){let t=this.VMAX_X/(lx.GAME.PHYSICS.STEPS*this.WEIGHT),i=this.VMAX_Y/(lx.GAME.PHYSICS.STEPS*this.WEIGHT);this.VX>0&&(this.VX-t<0?this.VX=0:this.VX-=t),this.VY>0&&(this.VY-i<0?this.VY=0:this.VY-=i),this.VX<0&&(this.VX+t>0?this.VX=0:this.VX+=t),this.VY<0&&(this.VY+i>0?this.VY=0:this.VY+=t)}},APPLY:function(t,i){t>0&&this.VX+t<=this.VMAX_X||t<0&&this.VX+t>=-this.VMAX_X?this.VX+=t:0!=t&&(this.VX+t>this.VMAX_X?this.VX=this.VMAX_X:this.VX+t<-this.VMAX_X&&(this.VX=-this.VMAX_X)),i>0&&this.VY+i<=this.VMAX_Y||i<0&&this.VY+i>=-this.VMAX_Y?this.VY+=i:0!=i&&(this.VY+i>this.VMAX_Y?this.VY=this.VMAX_Y:this.VY+i<-this.VMAX_Y&&(this.VY=-this.VMAX_Y))}}}Show(t){return null!=this.COLLIDER&&this.COLLIDER.Enable(),super.Show(t)}Hide(){return null!=this.COLLIDER&&this.COLLIDER.Disable(),super.Hide()}Sprite(t){return null==t?this.SPRITE:(this.SPRITE=t,this)}Identifier(t){return null==t?this.ID:(this.ID=t,this)}Size(t,i){return null==t&&null==i?this.SIZE:(null==i&&(i=t),this.SIZE={W:t,H:i},this)}Rotation(t){if(null==this.SPRITE&&null==this.ANIMATION)return this;if(null==t){if(null!=this.SPRITE&&null==this.ANIMATION)return this.SPRITE.Rotation();if(null!=this.ANIMATION)return this.ANIMATION.Rotation()}else null!=this.SPRITE&&null==this.ANIMATION?this.SPRITE.Rotation(t):null!=this.ANIMATION&&this.ANIMATION.Rotation(t);return this}Opacity(t){return null==t?this.OPACITY:(this.OPACITY=t,this)}Clip(t,i,E,s){if(null==this.SPRITE||null==this.SPRITE)return-1;if(null==this.ANIMATION){if(null==t||null==i||null==E||null==s)return this.SPRITE.Clip();this.SPRITE.Clip(t,i,E,s)}else{if(null==t||null==i||null==E||null==s)return this.ANIMATION.GET_CURRENT_FRAME().Clip();lx.GAME.LOG.ERROR("ClippingError","Clipping while an animation is playing is not possible.")}return this}Focus(){return lx.GAME.FOCUS_GAMEOBJECT(this),this}Movement(t,i){return null==t||null==i?{VX:this.MOVEMENT.VX,VY:this.MOVEMENT.VY}:(this.MOVEMENT.VX=t,this.MOVEMENT.VY=i,this)}AddVelocity(t,i){return this.MOVEMENT.APPLY(t,i),this}MaxVelocity(t,i){return null==t&&null==i?{VX:this.MOVEMENT.VMAX_X,VY:this.MOVEMENT.VMAX_Y}:(this.MOVEMENT.VMAX_Y=this.MOVEMENT.VMAX_X=t,null!=i&&(this.MOVEMENT.VMAX_Y=i),this)}MovementDecelerates(t){return null==t?this.MOVEMENT.DECELERATES:(this.MOVEMENT.DECELERATES=t,this)}Weight(t){return null==t?this.MOVEMENT.WEIGHT:(this.MOVEMENT.WEIGHT=t,this)}SetTopDownController(t,i,E,s){return lx.CONTEXT.CONTROLLER.TARGET=this,lx.OnKey("W",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(0,-i)}),lx.OnKey("A",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(-t,0)}),lx.OnKey("S",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(0,i)}),lx.OnKey("D",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(t,0)}),this.MaxVelocity(E,s),this}SetSideWaysController(t,i){return lx.CONTEXT.CONTROLLER.TARGET=this,lx.OnKey("A",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(-t,0)}),lx.OnKey("D",function(){lx.CONTEXT.CONTROLLER.TARGET.AddVelocity(t,0)}),this.MaxVelocity(i),this}CreateCollider(t,i){let E=this.Position(),s=this.Size();return this.COLLIDER=new lx.Collider(E.X,E.Y,s.W,s.H,t,i),this.COLLIDER.OFFSET={X:0,Y:0},this.COLLIDER.Enable(),this}ApplyCollider(t){if(null!=t)return t.ENABLED&&t.Disable(),this.COLLIDER=t,this.COLLIDER.OFFSET={X:t.POS.X,Y:t.POS.Y},this.COLLIDER.Enable(),this}ClearCollider(){if(null!=this.COLLIDER)return this.COLLIDER.Disable(),this.COLLIDER=void 0,this}ShowAnimation(t){return this.ANIMATION=t,this}ClearAnimation(){return this.ANIMATION=void 0,this}ShowColorOverlay(t,i){return null!=this.ANIMATION?this.ANIMATION.GET_CURRENT_FRAME().ShowColorOverlay(t,i):this.SPRITE.ShowColorOverlay(t,i),this}HideColorOverlay(){return this.SPRITE.HideColorOverlay(),this}Draws(t){return this.DRAWS=t,this}ClearDraws(){return this.DRAWS=void 0,this}OnMouse(t,i){return null!=this.CLICK_ID[t]?(lx.GAME.LOG.ERROR("GameObjectMouseError","GameObject already has a click handler for button "+t+"."),this):(this.CLICK_ID[t]=lx.GAME.ADD_GO_MOUSE_EVENT(this,t,i),this)}RemoveMouse(t){return null==this.CLICK_ID[t]?this:(lx.GAME.REMOVE_GO_MOUSE_EVENT(this.CLICK_ID[t]),this)}ClearMouse(){for(let t=0;t<this.CLICK_ID.length;t++)this.RemoveMouse(t)}OnHover(t){return null!=this.ON_HOVER?(lx.GAME.LOG.ERROR("GameObjectHoverError","GameObject already has a mouse hover handler."),this):(this.ON_HOVER=t,this)}OnHoverDraw(t){return null!=this.ON_HOVER_DRAW?(lx.GAME.LOG.ERROR("GameObjectHoverDrawError","GameObject already has a mouse hover draw handler."),this):(this.ON_HOVER_DRAW=t,this)}RemoveHover(){return this.ON_HOVER=void 0,this}RemoveHoverDraw(){return this.ON_HOVER_DRAW=void 0,this}RENDER(){null!=this.SPRITE&&null!=this.SPRITE&&lx.GAME.ON_SCREEN(this.POS,this.SIZE)&&(null==this.ANIMATION?this.SPRITE.RENDER(lx.GAME.TRANSLATE_FROM_FOCUS(this.POS),this.SIZE,this.OPACITY):this.ANIMATION.RENDER(lx.GAME.TRANSLATE_FROM_FOCUS(this.POS),this.SIZE,this.OPACITY),null!=this.ON_HOVER_DRAW&&lx.GAME.GET_MOUSE_IN_BOX(this.POS,this.SIZE)&&this.ON_HOVER({graphics:lx.CONTEXT.GRAPHICS,position:this.POS,size:this.SIZE}),null!=this.DRAWS&&this.DRAWS({graphics:lx.CONTEXT.GRAPHICS,position:this.POS,size:this.SIZE}))}UPDATE(){null!=this.TARGET&&(this.POS={X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y}),null!=this.ANIMATION&&this.ANIMATION.UPDATE(),null!=this.LOOPS&&this.LOOPS(),null!=this.ON_HOVER&&lx.GAME.GET_MOUSE_IN_BOX(this.POS,this.SIZE)&&this.ON_HOVER({position:this.POS,size:this.SIZE}),this.MOVEMENT.UPDATE(),this.POS.X+=this.MOVEMENT.VX,this.POS.Y+=this.MOVEMENT.VY,null!=this.COLLIDER&&(this.COLLIDER.POS={X:this.POS.X+this.COLLIDER.OFFSET.X,Y:this.POS.Y+this.COLLIDER.OFFSET.Y})}},this.Noise=class{constructor(t){null==t&&(t=Math.round(1e4*Math.random())),this.GRAD=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[1,0],[-1,0],[0,1],[0,-1],[0,1],[0,-1]],this.RANDOM=function(){let i=1e4*Math.sin(t++);return i-Math.floor(i)},this.P=[];for(let t=0;t<256;t++)this.P[t]=Math.floor(256*this.RANDOM());this.PERM=[];for(var i=0;i<512;i++)this.PERM[i]=this.P[255&i];this.DOT=function(t,i,E){return t[0]*i+t[1]*E},this.MIX=function(t,i,E){return(1-E)*t+E*i},this.FADE=function(t){return t*t*t*(t*(6*t-15)+10)}}Get(t,i){let E=Math.floor(t),s=Math.floor(i);t-=E,i-=s,E&=255,s&=255;let h=this.PERM[E+this.PERM[s]]%12,l=this.PERM[E+this.PERM[s+1]]%12,O=this.PERM[E+1+this.PERM[s]]%12,T=this.PERM[E+1+this.PERM[s+1]]%12,S=this.DOT(this.GRAD[h],t,i),n=this.DOT(this.GRAD[O],t-1,i),e=this.DOT(this.GRAD[l],t,i-1),A=this.DOT(this.GRAD[T],t-1,i-1),R=this.FADE(t),r=this.FADE(i),C=this.MIX(S,n,R),N=this.MIX(e,A,R);return this.MIX(C,N,r)}},this.Ray=class{constructor(t,i){this.POS={X:t,Y:i},this.DIR={X:0,Y:0}}Position(t,i){return null==t||null==i?this.POS:(this.POS={X:t,Y:i},this)}Direction(t,i){if(null==t||null==i)return this.DIR;{this.DIR={X:t-this.POS.X,Y:i-this.POS.Y};let E=Math.sqrt(this.DIR.X*this.DIR.X+this.DIR.Y*this.DIR.Y);this.DIR.X/=E,this.DIR.Y/=E}return this}Cast(t){return null!=t.COLLIDER&&this.CHECK_INTERSECTION_BOX(t.COLLIDER)}SAME_SIGN(t,i){return t>=0&&i>=0||t<=0&&i<=0}CHECK_INTERSECTION_BOX(t){let i=t.POS.X+t.SIZE.W,E=t.POS.Y+t.SIZE.H,s=-this.POS.Y-t.POS.Y;if(!this.SAME_SIGN(s,-this.DIR.Y))return!1;let h=(t.POS.X-this.POS.X)*(1/this.DIR.X),l=(i-this.POS.X)*(1/this.DIR.X),O=(t.POS.Y-this.POS.Y)*(1/this.DIR.Y),T=(E-this.POS.Y)*(1/this.DIR.Y),S=Math.max(Math.min(h,l),Math.min(O,T)),n=Math.min(Math.max(h,l),Math.max(O,T));return!(n<0||S>n)}},this.Scene=class{constructor(t){this.SAVED_STATE_AVAILABLE=!1,this.CALLBACK=t}Save(){this.BUFFER=lx.GAME.BUFFER,this.UI=lx.GAME.UI,this.COLLIDERS=lx.GAME.COLLIDERS,this.FOCUS=lx.GAME.FOCUS,this.CONTROLLER_TARGET=lx.CONTEXT.CONTROLLER.TARGET,this.EVENTS=lx.GAME.EVENTS,this.LOOPS=lx.GAME.LOOPS,this.GO_MOUSE_EVENTS=lx.GAME.GO_MOUSE_EVENTS,this.LAYER_DRAW_EVENTS=lx.GAME.LAYER_DRAW_EVENTS,this.AUDIO_CHANNELS=lx.GAME.AUDIO.CHANNELS,this.AUDIO_SOUNDS=lx.GAME.AUDIO.SOUNDS,this.SAVED_STATE_AVAILABLE=!0}Restore(){this.SAVED_STATE_AVAILABLE&&(lx.GAME.RESET(),lx.GAME.BUFFER=this.BUFFER,lx.GAME.UI=this.UI,lx.GAME.COLLIDERS=this.COLLIDERS,lx.GAME.FOCUS=this.FOCUS,lx.CONTEXT.CONTROLLER.TARGET=this.CONTROLLER_TARGET,lx.GAME.EVENTS=this.EVENTS,lx.GAME.LOOPS=this.LOOPS,lx.GAME.GO_MOUSE_EVENTS=this.GO_MOUSE_EVENTS,lx.GAME.LAYER_DRAW_EVENTS=this.LAYER_DRAW_EVENTS,lx.GAME.AUDIO.CHANNELS=this.AUDIO_CHANNELS,lx.GAME.AUDIO.SOUNDS=this.AUDIO_SOUNDS)}},this.Sound=class{constructor(t,i){this.SRC=t,this.POS={X:0,Y:0},this.PLAY_ID=[],this.CHANNEL=null!=i?i:0}Channel(t){return null==t?this.CHANNEL:(this.CHANNEL=t,this)}Play(t,i){if(null==this.PLAY_ID||null==lx.GAME.AUDIO.SOUNDS[this.PLAY_ID])return this.PLAY_ID=lx.GAME.AUDIO.ADD(this.SRC,this.CHANNEL,i,t),this}PlaySpatial(t,i){if(null==this.PLAY_ID||null==lx.GAME.AUDIO.SOUNDS[this.PLAY_ID])return this.PLAY_ID=lx.GAME.AUDIO.ADD_SPATIAL(this.POS,this.SRC,this.CHANNEL,i,t),this}Stop(){return null!=this.PLAY_ID&&lx.GAME.AUDIO.REMOVE(this.PLAY_ID),this.PLAY_ID=[],this}Position(t,i){return null==t||null==i?this.POS:(this.POS={X:t,Y:i},this)}},this.Sprite=class{constructor(t,i,E,s,h,l){this.CLIPPED_COLOR_OVERLAYS={},this.SPRITE_SIZE={W:0,H:0},this.ROTATION=0,null!=i&&"function"==typeof i&&(l=i,i=void 0),null==i&&null==E&&null==s&&null==h||(this.CLIP={X:i,Y:E,W:s,H:h}),this.CALLBACK=l,this.Source(t)}Size(){return null!=this.CLIP?{W:this.CLIP.W,H:this.CLIP.H}:{W:this.IMG.width,H:this.IMG.height}}Source(t){if(null==t)return null==this.IMG.src?void lx.GAME.LOG.ERROR("SpriteSourceError","Sprite has no source."):this.IMG.src;if("string"===typeof t){this.IMG=new Image;let i=this;this.IMG.onload=function(){i.SPRITE_SIZE.W=i.IMG.width,i.SPRITE_SIZE.H=i.IMG.height,null!=i.CALLBACK&&i.CALLBACK(i)},this.IMG.src=t}else null!=t.CANVAS?this.IMG=t.CANVAS:this.IMG=t;return this}Clip(t,i,E,s){return null==t||null==i||null==E||null==s?this.CLIP:(this.CLIP={X:t,Y:i,W:E,H:s},this)}Rotation(t){return null==t?this.ROTATION:(this.ROTATION=t,this)}Opacity(t){return null==t?this.OPACITY:(this.OPACITY=t,this)}ShowColorOverlay(t,i){return null==this.COLOR_OVERLAY&&null==t?this:(this.SET_COLOR_OVERLAY(t),this.SHOW_COLOR_OVERLAY=!0,this.COLOR_OVERLAY_DURATION=i,this)}HideColorOverlay(){return this.SHOW_COLOR_OVERLAY=!1,this}SET_COLOR_OVERLAY(t){if(null!=t){let i=t;if(null!=this.CLIP){let E="C"+t+"X"+this.CLIP.X+"Y"+this.CLIP.Y+"W"+this.CLIP.W+"H"+this.CLIP.H;if(null!=this.CLIPPED_COLOR_OVERLAYS[E])return void(this.COLOR_OVERLAY=this.CLIPPED_COLOR_OVERLAYS[E]);i=E}else{if(null!=this.COLOR_OVERLAY&&this.COLOR_OVERLAY._SAVE_ID===t)return;i=t}let E=this.Size(),s=document.createElement("canvas");s.width=E.W,s.height=E.H;let h=s.getContext("2d");h.fillStyle=t,h.fillRect(0,0,E.W,E.H),h.globalCompositeOperation="destination-atop",this.RENDER({X:0,Y:0},E,1,h),null!=i&&null!=this.CLIP&&(this.CLIPPED_COLOR_OVERLAYS[i]=s),s._SAVE_ID=i,this.COLOR_OVERLAY=s}return this}RENDER(t,i,E,s){let h=!1,l=!1;null==i&&(i=this.Size()),null==s?(s=lx.CONTEXT.GRAPHICS,i={W:i.W*lx.GAME.SCALE,H:i.H*lx.GAME.SCALE}):(s.imageSmoothingEnabled=lx.GAME.SETTINGS.AA,l=!0),null==E&&1==this.OPACITY||(null==E&&(E=this.OPACITY),s.save(),h=!0,s.globalAlpha=E);let O=this.IMG;if(this.SHOW_COLOR_OVERLAY&&(O=this.COLOR_OVERLAY),null==this.CLIP||this.SHOW_COLOR_OVERLAY){let E,T=lx.GetDimensions();!l&&i.W>T.width&&i.H>T.height&&(E={X:0,Y:0,W:T.width/lx.GAME.SCALE,H:T.height/lx.GAME.SCALE},t.X<0?(E.X-=t.X/lx.GAME.SCALE,t.X=0):t.X>0&&(E.W-=t.X/lx.GAME.SCALE),t.Y<0?(E.Y-=t.Y/lx.GAME.SCALE,t.Y=0):t.Y>0&&(E.H-=t.Y/lx.GAME.SCALE)),0===this.ROTATION?null==E?s.drawImage(O,t.X,t.Y,i.W,i.H):s.drawImage(O,E.X,E.Y,E.W,E.H,t.X,t.Y,E.W*lx.GAME.SCALE,E.H*lx.GAME.SCALE):(h||(s.save(),h=!0),s.translate(t.X+i.W/2,t.Y+i.H/2),s.rotate(this.ROTATION),null==E?s.drawImage(O,-i.W/2,-i.H/2,i.W,i.H):s.drawImage(O,E.X,E.Y,E.W,E.H,-E.W*lx.GAME.SCALE/2,-E.H*lx.GAME.SCALE/2,E.W*lx.GAME.SCALE,E.H*lx.GAME.SCALE))}else 0===this.ROTATION?s.drawImage(this.IMG,this.CLIP.X,this.CLIP.Y,this.CLIP.W,this.CLIP.H,t.X,t.Y,i.W,i.H):(h||(s.save(),h=!0),s.translate(t.X+i.W/2,t.Y+i.H/2),s.rotate(this.ROTATION),s.drawImage(this.IMG,this.CLIP.X,this.CLIP.Y,this.CLIP.W,this.CLIP.H,-i.W/2,-i.H/2,i.W,i.H));h&&s.restore(),s==lx.CONTEXT.GRAPHICS&&null!=this.COLOR_OVERLAY_DURATION&&(this.COLOR_OVERLAY_DURATION--,this.COLOR_OVERLAY_DURATION<=0&&this.HideColorOverlay())}};class i{constructor(t,i){this.POS={X:null==t?0:t,Y:null==i?0:i},this.OFFSET={X:this.POS.X,Y:this.POS.Y}}Show(){return null!=this.UI_ID?this:(this.UI_ID=lx.GAME.ADD_UI_ELEMENT(this),this)}Hide(){return null==this.UI_ID?this:(delete lx.GAME.UI[this.UI_ID],delete this.UI_ID,this)}Position(t,i){return null==t||null==i?this.POS:(this.POS={X:t,Y:i},null!=this.TARGET&&(this.OFFSET={X:t,Y:i}),this)}Follows(t){return null==t?this.TARGET:(this.TARGET=t,this)}StopFollowing(){return this.TARGET=void 0,this.POS={X:this.OFFSET.X,Y:this.OFFSET.Y},this}Loops(t){return this.LOOPS=t,this}ClearLoops(){return this.LOOPS=void 0,this}}this.UIButton=class extends i{constructor(t,i,E,s,h,l){super(E,s),this.SIZE={W:null==h?128:h,H:null==l?32:l},this.CALLBACK=function(){null!=this.ON_CLICK&&(lx.StopMouse(0),this.ON_CLICK())},this.WAS_FOCUSSED=!1,this.OPACITY=1,this.Text(t),this.Texture(i),null==t&&null==i&&lx.GAME.LOG.ERROR("ButtonCreationError","Created a button without either a text or texture, or both.")}OnClick(t){return null==t?this.ON_CLICK:(this.ON_CLICK=t,this)}Text(t){return null==t?this.TEXT:(this.TEXT=t,this.TEXT.Alignment("center"),this)}Texture(t){return null==t?this.TEXTURE:(this.TEXTURE=t,this)}Size(t,i){return null==t&&null==i?this.SIZE:(null==i&&(i=t),this.SIZE={W:t,H:i},this)}RENDER(){let t={X:this.POS.X,Y:this.POS.Y};null!=this.TARGET&&(t=lx.GAME.TRANSLATE_FROM_FOCUS({X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y})),null!=this.TEXTURE&&this.TEXTURE.RENDER(t,this.SIZE,this.OPACITY),null!=this.TEXT&&this.TEXT.RENDER({X:t.X+this.SIZE.W/2,Y:t.Y+this.SIZE.H/2+this.TEXT.SIZE*(1/3)},this.OPACITY)}UPDATE(){null!=this.LOOPS&&this.LOOPS();let t=null!=this.TARGET,i={X:this.POS.X+(t?this.TARGET.POS.X:0),Y:this.POS.Y+(t?this.TARGET.POS.Y:0)};lx.GAME.GET_MOUSE_IN_BOX(i,this.SIZE,t)?(this.OPACITY=.875,this.WAS_FOCUSSED=!0,document.body.style.cursor="pointer",lx.CONTEXT.CONTROLLER.MOUSE.BUTTONS[0]&&this.CALLBACK()):this.WAS_FOCUSSED&&(this.OPACITY=1,this.WAS_FOCUSSED=!1,document.body.style.cursor="default")}},this.UIRichText=class extends i{constructor(t,i,E,s,h,l){super(i,E),this.SIZE=null==s?14:s,this.COLOR=null==h?"whitesmoke":h,this.FONT=null==l?"Verdana":l,this.TEXT=t,this.ALIGN="left",this.LINE_HEIGHT=this.SIZE/4}Size(t){return null==t?this.SIZE:(this.SIZE=t,this)}LineHeight(t){return null==t?this.LINE_HEIGHT:(this.LINE_HEIGHT=t,this)}Text(t){return null==t?this.TEXT:(this.TEXT=t,this)}TextLine(t,i){if(null!=t&&null!=i)this.TEXT[t]=i;else if(null!=t)return this.TEXT[t];return this}Alignment(t){return null==t?this.ALIGN:(this.ALIGN=t,this)}Color(t){return null==t?this.COLOR:(this.COLOR=t,this)}Font(t){return null==t?this.FONT:(this.FONT=t,this)}SetShadow(t,i,E){return this.SHADOW={C:t,X:i,Y:E},this}ClearShadow(){return this.SHADOW=void 0,this}RENDER(){let t=1===lx.GAME.SCALE?1:.75*lx.GAME.SCALE;lx.CONTEXT.GRAPHICS.save(),lx.CONTEXT.GRAPHICS.font=this.SIZE*t+"px "+this.FONT,lx.CONTEXT.GRAPHICS.fillStyle=this.COLOR,lx.CONTEXT.GRAPHICS.textAlign=this.ALIGN,null!=this.SHADOW&&(lx.CONTEXT.GRAPHICS.shadowColor=this.SHADOW.C,lx.CONTEXT.GRAPHICS.shadowOffsetX=this.SHADOW.X,lx.CONTEXT.GRAPHICS.shadowOffsetY=this.SHADOW.Y);for(let i=0;i<this.TEXT.length;i++){let E=i*this.LINE_HEIGHT+i*this.SIZE*t;if(null!=this.TARGET){let t=lx.GAME.TRANSLATE_FROM_FOCUS({X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y});lx.CONTEXT.GRAPHICS.fillText(this.TEXT[i],t.X,t.Y+E)}else lx.CONTEXT.GRAPHICS.fillText(this.TEXT[i],this.POS.X,this.POS.Y+E)}lx.CONTEXT.GRAPHICS.restore()}UPDATE(){null!=this.LOOPS&&this.LOOPS()}},this.UIText=class extends i{constructor(t,i,E,s,h,l){super(i,E),this.TEXT=t,this.ALIGN="left",this.SIZE=null==s?14:s,this.COLOR=null==h?"whitesmoke":h,this.FONT=null==l?"Verdana":l}Size(t){return null==t?this.SIZE:(this.SIZE=t,this)}Text(t){return null==t?this.TEXT:(this.TEXT=t,this)}Alignment(t){return null==t?this.ALIGN:(this.ALIGN=t,this)}Color(t){return null==t?this.COLOR:(this.COLOR=t,this)}Font(t){return null==t?this.FONT:(this.FONT=t,this)}SetShadow(t,i,E){return this.SHADOW={C:t,X:i,Y:E},this}ClearShadow(){return this.SHADOW=void 0,this}RENDER(t,i){if(null==i&&(i=1),lx.CONTEXT.GRAPHICS.save(),lx.CONTEXT.GRAPHICS.font=this.SIZE*(1===lx.GAME.SCALE?1:.75*lx.GAME.SCALE)+"px "+this.FONT,lx.CONTEXT.GRAPHICS.fillStyle=this.COLOR,lx.CONTEXT.GRAPHICS.textAlign=this.ALIGN,lx.CONTEXT.GRAPHICS.globalAlpha=i,null!=this.SHADOW&&(lx.CONTEXT.GRAPHICS.shadowColor=this.SHADOW.C,lx.CONTEXT.GRAPHICS.shadowOffsetX=this.SHADOW.X,lx.CONTEXT.GRAPHICS.shadowOffsetY=this.SHADOW.Y),null==t)if(null!=this.TARGET){let t=lx.GAME.TRANSLATE_FROM_FOCUS({X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y});lx.CONTEXT.GRAPHICS.fillText(this.TEXT,t.X,t.Y)}else lx.CONTEXT.GRAPHICS.fillText(this.TEXT,this.POS.X,this.POS.Y);else lx.CONTEXT.GRAPHICS.fillText(this.TEXT,t.X+this.POS.X,t.Y+this.POS.Y);lx.CONTEXT.GRAPHICS.restore()}UPDATE(){null!=this.LOOPS&&this.LOOPS()}},this.UITexture=class extends i{constructor(t,i,E,s,h){super(i,E),this.SPRITE=t,this.SIZE={W:0,H:0},null!=s&&null!=h?this.SIZE={W:s,H:h}:"string"!=typeof t&&(this.SIZE=t.SPRITE_SIZE)}Size(t,i){return null==t?this.SIZE:(null==i&&(i=t),this.SIZE={W:t,H:i},this)}RENDER(t,i,E){null==E&&(E=1),null==i&&(i={W:this.SIZE.W,H:this.SIZE.H}),null==t&&null!=this.TARGET?t=lx.GAME.TRANSLATE_FROM_FOCUS({X:this.TARGET.POS.X+this.OFFSET.X,Y:this.TARGET.POS.Y+this.OFFSET.Y}):null==t?t=this.POS:(t.X+=this.POS.X,t.Y+=this.POS.Y),"string"==typeof this.SPRITE?(lx.CONTEXT.GRAPHICS.save(),lx.CONTEXT.GRAPHICS.fillStyle=this.SPRITE,lx.CONTEXT.GRAPHICS.globalAlpha=E,lx.CONTEXT.GRAPHICS.fillRect(t.X,t.Y,i.W,i.H),lx.CONTEXT.GRAPHICS.restore()):this.SPRITE.RENDER(t,i,E)}UPDATE(){null!=this.LOOPS&&this.LOOPS()}}}}const lx=new Lynx2D;